cmake_minimum_required(VERSION 3.0)
list(APPEND CMAKE_MODULE_PATH @PROJECT_DIR@)
enable_language(PANDOC)

if(NOT @PROJECT_NAME@_FIND_COMPONENTS)
    return()
endif()

macro(find_program_or_die _var _exe)
    find_program(${_var} ${_exe})
    if(${_var}-NOTFOUND)
        message(SEND_ERROR "Could not find ${_exe} executable")
    else()
        message(STATUS "Found ${_exe}: ${${_var}}")
    endif()
endmacro()

foreach(comp ${@PROJECT_NAME@_FIND_COMPONENTS})
    if(comp STREQUAL plantuml)
        find_program_or_die(PLANTUML_EXE plantuml)
        list(APPEND _programs "-DPLANTUML_EXE=${PLANTUML_EXE}")
    elseif(comp STREQUAL convert)
        find_package(ImageMagick COMPONENTS convert REQUIRED)
        list(APPEND _programs "-DIMAGEMAGICK_EXE=${ImageMagick_convert_EXECUTABLE}")
    elseif(comp STREQUAL dot)
        find_program_or_die(DOT_EXE dot DOC "Graphviz dot executable")
        list(APPEND _programs "-DDOT_EXE=${DOT_EXE}")
    else()
        message(SEND_ERROR "Unknown component")
    endif()
endforeach()

set(CMAKE_IMAGE_COMPILER_ARGS "${_programs}" CACHE INTERNAL "ImageCompiler args")

enable_language(IMAGE)
